# Google Cloud Document AI プロセッサ比較分析

## 実行日時
- Document OCR: 2026-02-09 22:00:37
- Form Parser: 2026-02-09 22:09:40

## 概要
OCRプロセッサとGoogle Cloud Vision APIからの移行において、3つのDocument AIプロセッサ（Layout Parser、Document OCR、Form Parser）を比較検証しました。

## プロセッサ詳細

### 1. Layout Parser (6af87434352688a1)
- **用途**: 文書の意味的分析、構造解析
- **結果**: visual_elements属性に座標情報を取得できないことが判明
- **制限**: 図表・画像の座標抽出が不可能
- **適用場面**: 文書構造の理解、セマンティック分析

### 2. Document OCR (d784f2907961b8a6) 
- **用途**: 光学文字認識、テキスト・座標抽出
- **結果**: ✅ 成功 - 完全な座標データ取得
- **特徴**: 
  - 詳細なテキストブロック座標
  - キーワード検索による画像エリア推定
  - 14個の椅子画像エリア成功抽出
- **適用場面**: 座標ベースの画像切り抜き、テキスト位置分析

### 3. Form Parser (338ea0ecd68b764b)
- **用途**: フォーム解析、構造化データ抽出
- **結果**: ✅ 成功 - フォーム要素 + 座標データ取得
- **特徴**:
  - フォームフィールド検出（今回は0個）
  - テーブル解析（今回は0個）
  - テキストブロック座標
  - キーワード検索による画像エリア推定
  - 11個の椅子画像エリア成功抽出

## 詳細比較

### テキスト解析結果
| 項目 | Document OCR | Form Parser |
|------|-------------|-------------|
| 全文字数 | 1,599文字 | 1,202文字 |
| テキストブロック | 32個 | 54個 |
| 段落 | 32個 | 54個 |
| 行 | 32個 | 54個（行: 10個） |
| トークン | 32個 | 582個（トークン: 15個） |
| フォームフィールド | - | 0個 |
| テーブル | - | 0個 |

### 座標抽出結果
| プロセッサ | visual_elements | 座標付きブロック | 推定画像エリア |
|-----------|----------------|----------------|----------------|
| Layout Parser | 0個（空） | 該当なし | 不可能 |
| Document OCR | 0個（空） | 32個 | 14個（5種類） |
| Form Parser | 0個（空） | 54個 | 11個（5種類） |

### キーワード検索結果
| キーワード | Document OCR | Form Parser |
|-----------|-------------|-------------|
| エッグチェア | 3ヶ所発見 | 3ヶ所発見 |
| アントチェア | 3ヶ所発見 | 3ヶ所発見 |
| スワンチェア | 2ヶ所発見 | 2ヶ所発見 |
| セブンチェア | 2ヶ所発見 | 2ヶ所発見 |
| ベルビュー・チェア | 1ヶ所発見 | 1ヶ所発見 |
| アリンコチェア | 1ヶ所発見 | 0ヶ所 |

### 切り抜き画像結果
| プロセッサ | 成功画像数 | 保存先フォルダ |
|-----------|-----------|---------------|
| Document OCR | 14個 | extracted_images/ |
| Form Parser | 11個 | form_parser_images/ |

## 技術的考察

### 1. テキスト認識精度
- **Document OCR**: より完全なテキスト抽出（1,599文字）
- **Form Parser**: 一部テキストの分割・欠落（1,202文字）
- **推定理由**: Document OCRはテキスト抽出に特化、Form Parserは構造解析に重点

### 2. ブロック分割方式
- **Document OCR**: 32個の大きなテキストブロック
- **Form Parser**: 54個のより細かいブロック分割
- **影響**: Form Parserの方が詳細な位置情報を提供するが、テキストの完全性は低下

### 3. 座標精度
- 両プロセッサとも`bounding_poly.normalized_vertices`による正確な座標情報を提供
- キーワードベースの画像エリア推定は両者で同様の結果

### 4. visual_elements制限
- **全プロセッサ共通**: visual_elements配列が空
- **原因**: Document AI v1の制限、またはPDF内の図表が検出対象外
- **対策**: キーワードベースの推定アルゴリズムで補完

## 推奨使用場面

### Document OCR
- **最適**: テキスト座標が重要な場合
- **用途**: 文書のテキスト位置分析、座標ベース画像切り抜き
- **メリット**: 完全なテキスト抽出、安定した座標データ

### Form Parser
- **最適**: フォーム・表の構造化データが重要な場合
- **用途**: フォーム入力データ抽出、表データの構造化
- **メリット**: フォームフィールド・テーブル検出、詳細ブロック分割

### Layout Parser
- **最適**: 文書の意味的構造理解が重要な場合
- **用途**: 文書分類、セマンティック分析
- **制限**: 座標・画像抽出には不適合

## 結論

**OCRプロセッサ + Google Cloud Vision API からの移行において：**

1. **座標ベースの画像抽出**: Document OCR が最適
2. **フォーム・表データ抽出**: Form Parser が最適  
3. **文書構造理解**: Layout Parser が最適

**キーワードベース画像推定システム**により、visual_elementsの制限を克服し、両プロセッサで椅子画像の切り抜きに成功しました。

移行先としては、用途に応じて：
- **画像切り抜き重視**: Document OCR
- **構造化データ重視**: Form Parser
- **ハイブリッド**: 用途別に使い分け